<?php if(substr($location,0,8)==='/images/'){$file=substr($location,8);if(mysql_fetch_array(mysql_query('SELECT * FROM '.$prefix.'mod_images WHERE image="'.$file.'"'))){$content=mysql_fetch_assoc(mysql_query('SELECT * FROM '.$prefix.'content WHERE page="/images"'));$location='/images';$dependent='1';$nf=false;}else{unset($file);}}function ahobbler_images($sort,$way){if($sort=''){$sort='image';}if($sort!=='image'&&$sort!=='type'&&$sort!=='size'&&$sort!=='alt'){$sort='image';}echo '<table><tr><th>Preview</th>';echo '<th><a href="/images?sort=image';$arrowd='&nbsp;<img src="/images/arrowdn.png" alt="" />';$arrowu='&nbsp;<img src="/images/arrowup.png" alt="" />';if($sort==='image'&&$_GET['way']!=="desc"){echo '&amp;way=desc';}echo '" rel="alternative" rev="alternative">Name';if($sort==='image'&&$way!=='desc'){echo $arrowd;}else if($sort==='image'){echo $arrowu;}echo '</a></th><th><a href="/images?sort=size';if($sort==='size'&&$way!=='desc'){echo '&amp;way=desc';}echo '" rel="alternative" rev="alternative">Size';if($sort==='size'&&$way!=='desc'){echo $arrowd;}else if($sort==='size'){echo $arrowu;}echo '</a></th><th><a href="/images?sort=type';if($sort==='type'&&$way!=='desc'){echo '&amp;way=desc';}echo '" rel="alternative" rev="alternative">Type';if($sort==='type'&&$way!=='desc'){echo $arrowd;}else if($sort==='type'){echo $arrowu;}echo '</a></th></tr>';unset($arrowu,$arrowd);if($way==='desc'){$wayl=" DESC";}$query=mysql_query('SELECT * FROM '.$prefix.'mod_images ORDER BY '.$sort.$wayl);unset($sort,$wayl,$way);while($img=mysql_fetch_assoc($query)){echo '<tr><th><a href="/images/'.$img['image'].'"><img src="/images/'.$img['image'].'" class="icon" alt="'.$img['image'].'" /></a></th><td><a href="/images/'.$img['image'].'">'.$img['image'].'</a></td><td>';$sizetype=' B';if(($img['size']/1024)>=0.5){$img['size']=$img['size']/1024;$sizetype=' KB';}if(($img['size']/1024)>=0.5){$img['size']=$img['size']/1024;$sizetype=' MB';}if(($img['size']/1024)>=0.5){$img['size']=$img['size']/1024;$sizetype=' GB';}$img['size']=round($img['size'],2);echo $img['size'].$sizetype.'</td><td>'.$img['type'].'</td></tr>';}echo "</table>\n";unset($img,$sizetype,$query);}function ahobbler_images_show($file){$img=mysql_fetch_assoc(mysql_query('SELECT * FROM '.$prefix.'mod_images WHERE image="'.$file.'"'));if($img['content']==NULL){global $config;$tmpfile='templates/'.$config['template'].'/images/'.$file;$base=str_ireplace('mods/images/index.php','',__FILE__);if(file_exists($base.$tmpfile)){$base='../';$_GET['url']='/images/'.$file;include('../index.php');}else{header('Content-Type: '.$config['type']);header('HTTP/1.0 404 Not Found');echo 'Image Not Found';die();}unset($base,$tmpfile,$config);}header('Content-type: '.$img['type']);if(date('d')!==1){$expires=substr(date('r',mktime(date('G'),date('i'),date('s'),date('m'),date('d')-1,date('y')+1)),0,25);}else{$expires=substr(date('r',mktime(date('G'),date('i'),date('s'),date('m')-1,date('d')+28,date('y')+1)),0,25);}$etag=md5($file.gmdate('dmyHis',$img['lastmod']));header('Expires: '.$expires.' GMT');header('Last-Modified: '.gmdate('D, d M Y H:i:s',$img['lastmod']).' GMT');header('Cache-Control: public, max-age=31536000');header('ETag: '.$etag);unset($expires,$etag);header('Vary: Accept-Encoding');if(stristr($file,'.php')){eval('?>'.$img['content']);}else{echo $img['content'];}unset($img,$file);die();}?>