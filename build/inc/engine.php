<?php if(!isset($base))$base='./';if(!file_exists($base.'inc/config.php')){header('Location: '.$base.'setup');die();}require('config.php');@$mysqlconnect=mysql_connect($sql_login['server'],$sql_login['user'],$sql_login['pass'])or die($sql_login['die']);mysql_select_db($sql_login['db'],$mysqlconnect);$prefix=$sql_login['prefix'];unset($sql_login);if(isset($_GET['url']))$location='/'.$_GET['url'];else $location=$_SERVER['PHP_SELF'];while(stristr($location,'../'))$location=str_replace('../','',$location);$path=$location;$location=str_replace('index.php','',$location);if(($config['directory']!=='/'||$config['directory']==NULL)&&$config['directory']===substr($location,0,strlen($config['directory'])))$location=substr($location,strlen($config['directory']),strlen($location));if(substr($location,strlen($location)-1)==='/'&&strlen($location)!==1)$location=substr($location,0,strlen($location)-1);$content=mysql_fetch_assoc(mysql_query('SELECT * FROM '.$prefix.'content WHERE page="'.$location.'"'));$nf=false;if($content==NULL){$content=mysql_fetch_assoc(mysql_query('SELECT * FROM '.$prefix.'content WHERE page="/error"'));$nf=true;}$prefs=mysql_fetch_assoc(mysql_query('SELECT * FROM '.$prefix.'preferences'));if(!isset($dependent))$dependent=$content['dependent'];unset($result);function placeto_prefs($dbtype){global $prefs;echo $prefs[$dbtype];unset($dbtype);return true;}function placeto_configs($dbtype){global $config;echo $config[$dbtype];unset($dbtype);return true;}function placeto($dbtype){global $content,$prefs,$config,$location;if($dbtype==='content')eval('?>'.$content['content']."\n");else if($dbtype==='site')echo $prefs['name'];else if($dbtype==='base'){echo $config['site'];echo $config['directory'];if($config['directory']!=='/')echo '/';}else if($dbtype==='directory'){echo $config['directory'];if($config['directory']!=='/')echo '/';}else if($dbtype==='canonical'){echo $config['site'];if($config['directory']!=='/')echo $config['directory'];echo $location;}else if($dbtype==='copyright')echo $prefs['copyright'];else echo $content[$dbtype];unset($dbtype);return true;}function placeto_extension($ext){$exts=array(".css"=>"text/css",".js"=>"text/javascript",".png"=>"image/png",".gif"=>"mage/gif",".jpg"=>"image/jpeg",".jpeg"=>"image/jpeg",".ico"=>"image/x-icon",".htm"=>"text/html",".html"=>"text/html",".xhtml"=>"text/html",".xml"=>"text/xml",".txt"=>"text/plain",".psd"=>"image/vnd.adobe.photoshop");if($exts[$ext]){$exts=$exts[$ext];return $exts;}else{unset($exts);return false;}}$result=mysql_query('SELECT * FROM '.$prefix.'mods');while($mod_temps=mysql_fetch_assoc($result))$mod_starts[$mod_temps['name']]=$mod_temps['enable'];$mfiles=scandir($base.'inc/mods');foreach($mfiles as $mfile){if(!strrpos($mfile,'.')&&$mfile!=='.'&&$mod_starts[$mfile]['enable'])include($base.'inc/mods/'.$mfile.'/index.php');else if(!strrpos($mfile,'.')&&$mfile!=='.')@include($base.'inc/mods/'.$mfile.'/prototype.php');}$result=mysql_query('SELECT * FROM '.$prefix.'mods_vars');while($mod_temps=mysql_fetch_assoc($result))$mod_vars[$mod_temps['mod']][$mod_temps['name']]=$mod_temps['value'];unset($mfiles,$mfile,$mod_starts,$mod_temps);if($nf){$tmpfile='templates/'.$config['template'].$location;$base=str_ireplace('reattach.php','',__FILE__);if(file_exists($base.$tmpfile)&&$location!=='/'){$extension=strrchr($path,'.');if(placeto_extension($extension))header('Content-Type: '.placeto_extension($extension));else if(function_exists('finfo_file')){$finfo=finfo_open(FILEINFO_MIME);header('Content-Type: '.finfo_file($finfo,$base.$tmpfile));finfo_close($finfo);unset($finfo);}else header('Content-Type: '.mime_content_type($base.$tmpfile));unset($path,$extension);header('Content-Length:'.filesize($base.$tmpfile));if(date('d')!==1)$expires=substr(date('r',mktime(date('G'),date('i'),date('s'),date('m'),date('d')-1,date('y')+1)),0,25);else $expires=substr(date('r',mktime(date('G'),date('i'),date('s'),date('m')-1,date('d')+28,date('y')+1)),0,25);$etag=md5($location.gmdate('dmyHis',filemtime($base.$tmpfile)));header('Expires: '.$expires.' GMT');header('Last-Modified: '.gmdate('D, d M Y H:i:s',filemtime($base.$tmpfile)).' GMT');header('Cache-Control: public, max-age=31536000');header('ETag: '.$etag);unset($expires,$etag);header('Vary: Accept-Encoding');readfile($base.$tmpfile);unset($base,$tmpfile);mysql_close($mysqlconnect);unset($mysqlconnect);die();}else{header('Content-Type: '.$config['type']);header('HTTP/1.0 404 Not Found');include('templates/'.$config['template'].'/index.php');}}else if($dependent==='1'||($dependent==='2'&&isset($_GET[$content['dependentparam']])))eval('?>'.$content['content']);else{header('Content-Type: '.$config['type']);include('templates/'.$config['template'].'/index.php');}unset($config,$content,$prefs,$nf,$mod_starts,$base,$mysqlconnect);mysql_close($mysqlconnect);while(@ob_end_flush());exit(0);?>